\documentclass[DM,authoryear,toc]{lsstdoc}
% lsstdoc documentation: https://lsst-texmf.lsst.io/lsstdoc.html
\input{meta}

% Package imports go here.
\usepackage{listings}
\usepackage{color}

\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}

\newenvironment{allintypewriter}{\ttfamily}{\par}

\lstset{frame=tb,
  language=SQL,
  aboveskip=3mm,
  belowskip=3mm,
  showstringspaces=false,
  columns=flexible,
  basicstyle={\small\ttfamily},
  numbers=none,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{dkgreen},
  stringstyle=\color{mauve},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=3
}


% Local commands go here.

%If you want glossaries
%\input{aglossary.tex}
%\makeglossaries

\title{Verification Tests of the DP0.1 TAPserver on IDF}

% Optional subtitle
% \setDocSubtitle{A subtitle}

\author{%
Douglas Tucker
}

\setDocRef{RTN-026}
\setDocUpstreamLocation{\url{https://github.com/lsst/rtn-026}}

\date{\vcsDate}

% Optional: name of the document's curator
% \setDocCurator{The Curator of this Document}

\setDocAbstract{%
DP0.1 contains the DWF data set from the Vera C. Rubin LSST DESC DR2.  This data set contains, among other material, images and catalogs for c. 300 sq deg of contiguous sky within the LSST footprint.  Here, we present verfication tests of the catalog data contained within the DP0.1 TAPserver on the Interim Data Facility (IDF).
}

% Change history defined here.
% Order: oldest first.
% Fields: VERSION, DATE, DESCRIPTION, OWNER NAME.
% See LPM-51 for version number policy.
\setDocChangeRecord{%
  \addtohist{1}{YYYY-MM-DD}{Unreleased.}{Douglas Tucker}
}


\begin{document}

% Create the title page.
\maketitle
% Frequently for a technote we do not want a title page  uncomment this to remove the title page and changelog.
% use \mkshorttitle to remove the extra pages

% ADD CONTENT HERE
% You can also use the \input command to include several content files.

\lstset{language=Python}
\begin{lstlisting}
for table in ['forced_photometry', 'object', 'position', 'reference', 'truth_match']:
   query = """SELECT count(*) FROM dp01_dc2_catalogs.%s""" % (table)
   print(query)
   results = service.search(query)
   df = results.to_table().to_pandas()
   count = df['count'].iloc[0]
   print(count)
   print("")
\end{lstlisting}

\lstset{language=SQL}
\begin{lstlisting}
SELECT count(*) FROM dp01_dc2_catalogs.forced_photometry
147088445

SELECT count(*) FROM dp01_dc2_catalogs.object
147088478

SELECT count(*) FROM dp01_dc2_catalogs.position
147088445
 
SELECT count(*) FROM dp01_dc2_catalogs.reference
147088445

SELECT count(*) FROM dp01_dc2_catalogs.truth_match
765823615
\end{lstlisting}


\lstset{language=Python}
\begin{lstlisting}
%%time
now0=datetime.now()

# `tract` is not a column in forced_photometry;
#   so we need to be a little tricky...
query = """SELECT DISTINCT obj.tract 
           FROM %s.object as obj
           JOIN %s as x
           ON obj.objectId = x.objectId  
           ORDER BY obj.tract""" % \
        (schema_name, table_full_name)
print(query)

results = service.search(query)

df = results.to_table().to_pandas()
tract_list = df['tract'].tolist()

now1=datetime.now()
print("Total time:", now1-now0)

print(tract_list)
\end{lstlisting}

%\begin{allintypewriter}
\lstset{language=sh}
\begin{lstlisting}
SELECT DISTINCT obj.tract 
           FROM dp01_dc2_catalogs.object as obj
           JOIN dp01_dc2_catalogs.position as x
           ON obj.objectId = x.objectId  
           ORDER BY obj.tract
Total time: 0:01:53.352097
[2723, 2724, 2725, 2726, 2727, 2728, 2729, 2730, 2731, 2732, 2733, 2734, 2735, 2896, 2897, 2898, 2899, 2900, 2901, 2902, 2903, 2904, 2905, 2906, 2907, 2908, 3074, 3075, 3076, 3077, 3078, 3079, 3080, 3081, 3082, 3083, 3084, 3085, 3086, 3256, 3257, 3258, 3259, 3260, 3261, 3262, 3263, 3264, 3265, 3266, 3267, 3268, 3441, 3442, 3443, 3444, 3445, 3446, 3447, 3448, 3449, 3450, 3451, 3452, 3453, 3454, 3631, 3632, 3633, 3634, 3635, 3636, 3637, 3638, 3639, 3640, 3641, 3642, 3643, 3825, 3826, 3827, 3828, 3829, 3830, 3831, 3832, 3833, 3834, 3835, 3836, 3837, 4022, 4023, 4024, 4025, 4026, 4027, 4028, 4029, 4030, 4031, 4032, 4033, 4034, 4035, 4224, 4225, 4226, 4227, 4228, 4229, 4230, 4231, 4232, 4233, 4234, 4235, 4236, 4429, 4430, 4431, 4432, 4433, 4434, 4435, 4436, 4437, 4438, 4439, 4440, 4441, 4636, 4637, 4638, 4639, 4640, 4641, 4642, 4643, 4644, 4645, 4646, 4647, 4648, 4850, 4851, 4852, 4853, 4854, 4855, 4856, 4857, 4858, 4859, 4860, 5065, 5066, 5067, 5068, 5069, 5070, 5071, 5072, 5073, 5074]
CPU times: user 12.5 ms, sys: 3.93 ms, total: 16.4 ms
Wall time: 1min 53s
\end{lstlisting}
%\end{allintypewriter}

\appendix
% Include all the relevant bib files.
% https://lsst-texmf.lsst.io/lsstdoc.html#bibliographies
\section{References} \label{sec:bib}
\renewcommand{\refname}{} % Suppress default Bibliography section
\bibliography{local,lsst,lsst-dm,refs_ads,refs,books}

% Make sure lsst-texmf/bin/generateAcronyms.py is in your path
\section{Acronyms} \label{sec:acronyms}
\input{acronyms.tex}
% If you want glossary uncomment below -- comment out the two lines above
%\printglossaries






\end{document}
